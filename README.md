
# PRD：移动端扫码点餐系统（SvelteKit + Supabase + Vercel）

**版本**：v1.2
**状态**：待开发
**目标用户**：餐厅顾客 & 店员（后台管理）
**核心价值**：顾客自主点餐，多次下单聚合显示，后台实时管理，打印订单给后厨

---

## 一、产品概述

* 顾客扫码桌子二维码进入点餐页面
* 支持同桌多次下单，后台聚合显示子订单，按顺序标明第几次下单
* 后台点击“结束订单”才算结账，下次扫码生成新订单组
* 后台可以新增/删除桌子，生成二维码；管理菜品、小料；导出订单与桌子二维码
* 数据库使用 Supabase，提供实时同步，保证后台手机端可以实时看到新订单

---

## 二、功能需求（维持 v1.1 核心逻辑）

### 2.1 顾客端

* 扫码桌号 → 绑定当前未结账订单组
* 菜品浏览（分类、图片、名称、单价）
* 选择小料 → 添加购物车 → 提交订单
* 支持继续下单 → 订单累加到同一订单组
* 显示当前桌号下单次数（第几次下单，可选）

### 2.2 后台端

* **桌子管理**：新增/删除桌子 → 自动生成二维码 → 下载/打印
* **订单管理**：

  * 按桌号聚合显示订单组
  * 子订单显示菜品、小料、数量、单价、小计
  * 聚合总价显示桌号总价
  * 修改订单状态（制作中 / 已完成）
  * 点击“结束订单” → 桌号释放，下一次扫码生成新订单组
  * 导出订单 CSV / Excel / PDF
* **菜品管理**：新增/编辑/删除菜品
* **小料管理**：新增/编辑/删除小料

---

## 三、数据库设计（Supabase）

### 3.1 桌子表（Table）

| 字段                     | 类型        | 说明                 |
| ---------------------- | --------- | ------------------ |
| table_id               | varchar   | 桌号（主键）             |
| current_order_group_id | int       | 当前活跃订单组（null 表示空桌） |
| created_at             | timestamp | 创建时间               |
| updated_at             | timestamp | 最近更新               |

### 3.2 订单组表（OrderGroup）

| 字段         | 类型        | 说明       |
| ---------- | --------- | -------- |
| id         | int       | 主键       |
| table_id   | varchar   | 桌号       |
| status     | varchar   | 未结/已结    |
| created_at | timestamp | 第一次下单时间  |
| updated_at | timestamp | 最近一次下单时间 |

### 3.3 订单表（Order）

| 字段             | 类型        | 说明                                          |
| -------------- | --------- | ------------------------------------------- |
| id             | int       | 子订单号                                        |
| order_group_id | int       | 所属订单组                                       |
| items          | jsonb     | [{dish_id, name, qty, options, unit_price}] |
| total_price    | numeric   | 小计                                          |
| created_at     | timestamp | 下单时间                                        |

### 3.4 菜品表（Dish）

| 字段        | 类型      | 说明     |
| --------- | ------- | ------ |
| id        | int     | 主键     |
| name      | varchar | 菜品名称   |
| price     | numeric | 单价     |
| category  | varchar | 分类     |
| image_url | varchar | 图片链接   |
| options   | jsonb   | 可选小料列表 |
| status    | boolean | 上架/下架  |

### 3.5 小料表（Option）

| 字段     | 类型      | 说明     |
| ------ | ------- | ------ |
| id     | int     | 主键     |
| name   | varchar | 小料名称   |
| price  | numeric | 单价（可选） |
| status | boolean | 上架/下架  |

**备注**：Supabase 实时功能可用于前端实时更新订单列表，无需轮询

---

## 四、前端页面设计（SvelteKit）

### 4.1 顾客端

1. **扫码首页**

   * 桌号显示
   * 菜品分类导航
   * 菜品列表（图片、名称、价格、小料按钮）

2. **购物车 / 确认订单**

   * 显示菜品、小料、数量、单价、小计
   * 修改数量 / 删除
   * 提交订单 → 属于当前桌号活跃订单组
   * 支持继续下单

3. **订单历史（可选）**

   * 当前桌号下单次数显示（第几次下单）

### 4.2 后台端（手机）

1. **桌子管理页**

   * 桌号列表 + 当前活跃订单状态 + 下单次数统计
   * 新增桌子 → 生成二维码
   * 删除桌子
   * 导出二维码 PDF/PNG

2. **订单管理页**

   * 按桌号聚合显示订单组
   * 子订单显示菜品、小料、数量、单价、小计
   * 聚合总价显示桌号总价
   * 修改状态 / 结束订单
   * 导出打印

3. **菜品管理页**

   * 编辑/上下架/删除/新增

4. **小料管理页**

   * 编辑/删除/绑定菜品

---

## 五、二维码规则

* URL 示例：`https://your-domain.com/order?table=桌号`
* 每个桌号生成唯一二维码，顾客扫码自动识别桌号并绑定订单组

---

## 六、核心业务流程（多次下单聚合）

1. 后台新增桌子 → 生成二维码 → 打印桌子贴上
2. 顾客扫码 → 绑定桌号 → 当前活跃订单组
3. 顾客多次下单 → 每次生成子订单 → 聚合到订单组
4. 后台显示聚合订单，标注第几次下单
5. 用餐结束 → 后台点击“结束订单” → 桌号活跃订单组结束
6. 下次扫码同桌生成新订单组

---

## 七、技术选型

| 功能      | 技术                                            |
| ------- | --------------------------------------------- |
| 前端 / 后端 | **SvelteKit**（支持全栈 API 与 PWA）                 |
| 数据库     | **Supabase**（PostgreSQL + 实时同步）               |
| 部署      | **Vercel**                                    |
| 图片存储    | Supabase Storage 或 Vercel 静态文件                |
| 二维码生成   | 前端库 `qrcode` / `qrcode.react` 或后端生成 PNG / PDF |
| 导出订单    | 前端 `js-xlsx` 或后端生成 CSV / PDF                  |
| 实时更新    | Supabase Realtime / WebSocket（前端订阅订单表变化）      |

---

画一张**完整流程图 + 数据流图**，把：

* 顾客扫码 → 多次下单 → 后台聚合显示
* 第几次下单显示逻辑
* 结束订单释放桌号
* Supabase + SvelteKit + Vercel 的技术流
